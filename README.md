# Stock Technical Analysis
Command line based stock analysis by RSI (Relative Strength Index) and MACD (Moving Average Convergence Divergence) Indicators.

**Requirements**
- Python 3
- Local Database (SQL, Postgres(Recommended), Oracle)

## Installation
Follow below steps to install Stock Technical Analysis

**1. Create a database**
Create a database in the database server available e.g. ORACLE, mySQL, POSTGRES(Recommended)

**2. Clone the repository using git bash**
```sh
$ git clone git@github.com:abhishekmorya/stock-technical-analysis.git
```

**3. Update the `database.ini` present in `config` directory file with database details as below**
```
[dbparams]
host=<hostname>
dbname=<Database Name>
user=<User Name>
password=<Password>
port=<Port>
```

**4. Create `data_dir`**
Create a directory to save the csv files data and update the `data_dir` key in the `conf.yaml` file available in `config` directory. The csv files generated by the data retrieved from api will be saved here.

**5. Create python virtual environment and install required packages**
Create virtual environment
*Windows*
```sh
$ python -m venv env
$ .\env\Scripts\activate
```
*Linux or MAC*
```sh
$ python3 -m venv env
$ source env/bin/activate
```

**5. Once the environment activated, we are ready to install packages of python using pip**
```sh
$ cd stock-technical-analysis
$ pip install -r requirements.txt
```
*Note: Make sure your device is connected to Internet.*

**6. Create tables**
To create all the tables needed. Basically three tables (stock, stock_rsi, stock_macd).
Move to directory where `main.py` script is available and run below two commands in same order. This creates tables for the stocklist in the `stock-list.yaml` file in `config` directory.
```sh
$ python main.py create_templates
$ python main.py create_tables
```

Now we are all set to use the **stock analysis** application

## Few Points about application
- There are 98 large cap stocks are listed in the `conf.yaml` file under `config` directory. Command for all stocks means the command for this list of stocks. This list can be updated as per the needs.
- By default it is loading data from <https://www.alphavantage.co> api. For more info check its [documentation](https://www.alphavantage.co/documentation/)
- For each stock three tables will be created for stock, stock rsi calculation, stock macd calculation and stochastic namly ***stock***, ***stock_rsi***, ***stock_macd*** and ***stock_stoch*** respectively.
- The analysis feature of the api will provide list of stocks based on the filter conditions preset in the application.
- Application only focused on the stocks listed in BSE. So stock code should be provided from the BSE listings. e.g. TCS for Tata Consultancy Service, RELIANCE for Reliance Industries, AXISBANK for Axis Bank. However it is always a choice to analyse from NSE. For that change the api url, drop the database and recreate tables.

## How to use the application
There are four features of the application. These features can be used by running commands from command line in windows or from terminal in linux/MAC.
The four features are
1. load: to load the stocks from api to database tables
2. calculate : to calculate rsi, stochastic and macd from data in stocks table and load to respective tables
3. analyse: creates a view named analytic_vw for provided day date and stock name.
4. view: using different analysis filters fetching data from analytic_vw view.

### Load
Application loads only last 100 days of stock data of a stock by default. There is an option to load last 20 Years of data also, by updating `outputsize=full` in api_url file in config directory. This value is `outputsize=compact`by default. It is recommended to use `compact` option to fasten the process and save space.

>You need to generate the free api key from [Claim your free api key](https://www.alphavantage.co/support/#api-key) by filling a small form. Note down the key and save for future usage. Paste that api key to `api_key` field in `conf.yaml` file in `config` directory.
> ***Note: Without this key data will not be retrieved from api.***

To load data use below command. This loads stock data for all the stock in list. A perticular stock data can be loaded by the second command where the stock code has given as other option.
```sh
$ python main.py load
$ python main.py load RELIANCE
```

> Sometimes you already have the csv available in `data_dir` from any of the previous load. Then directly from csv file stock data can loaded without calling api. Just make the `offline: True` in `conf.yaml` file in `config` directory then run load command.
> **Note: Any changes to columns or data in csv can create mazor problems**


> **TIP**
> You can use `outputsize=full` at first time setup. After completion move the csv files generated in data_dir to seperate location and change the outputsize to compact as `outputsize=compact` again. Because when we run load again it just updates the new dates does not replace the previous dates in order to fasten the process. So there is no point to retrieve the 20 years data again.

### Calculate RSI/MACD/STOCH
There are three modes when doing the calculation.

**Calculating data for first time**
This Calculates for all the dates in stock table and updates the calculation for respective stock. The second command is for calculating for a perticular stock.
```sh
$ python main.py init_calc
$ python main.py init_calc RELIANCE
```

**Updating the calculation**
This updates the calculation tables with new dates. New dates will be taken from stock table. The second command for calculation update for a perticular stock.
```sh
$ python main.py update
$ python main.py update RELIANCE
```

**Recalculation**
There are chances that something goes wrong about calculation and you feel tables are incorrectly calculated. No Worries! Run below command to recalculate. It will truncate the rsi, stochastic and macd tables and do the calculation for all data in stock tables.
Same can be done for a perticular stock by second command.
```sh
$ python main.py recalculate
$ python main.py recalculate RELIANCE
```

### Analyse
Analyse part creates a view `analytic_vw` from rsi and macd tables taking the provided date `dd/mm/yyyy` calculation.
```sh
$ python main.py analyse 30/08/2022
```

### View
This part is to view the analysis by different sql queries. These queries are preset already. Use below command to run this as `python main.py view <query number>`
```
$ python main.py view 1
```
By default query 1 will run if no number provided. The values of uprsi, lowrsi, uphist, lowhist can be reconfigured as per your choice in `conf.yaml` in `config` directory.
List of preset queries.
***And of course! you can have custom analysis with custom queries using database seperately.***

```sql
--1
  select * from analytic_vw
  where (rsi <= {uprsi} and rsi >= {lowrsi})
  and hist <= {uphist} and hist >= {lowhist}
  order by hist, rsi;
--2
  select * from analytic_vw
  where rsi <= {uprsi}
  order by rsi;

--3
  select * from analytic_vw
  where rsi >= {lowrsi}
  order by rsi;

--4
  select * from analytic_vw
  where abs(hist) <= {uphist}
  order by abs(hist);

--5
  select * from analytic_vw
  where abs(hist) >= {lowhist}
  order by abs(hist);
```

### That's All! Enjoy.